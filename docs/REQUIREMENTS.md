# VOC Auto Bot 요구사항 정의서

## 1. 개요

### 1.1 목적
VOC(Voice of Customer) 처리 프로세스를 자동화하여 VOC 접수자가 즉시 응대가 가능한 환경을 구축한다.

### 1.2 범위
- VOC 접수 및 관리 시스템
- AI 기반 VOC 자동 분석
- 로그 분석 연동 (ELK(OpenSearch))
- 담당자용 대시보드

---

## 2. 용어 정의

> **중요**: 본 문서에서 사용하는 용어의 정의를 명확히 합니다.

| 용어 | 정의 | 비고 |
|------|------|------|
| **최종 사용자 (End User)** | 실제 서비스를 이용하는 고객 | 시스템에 직접 접근하지 않음 |
| **VOC 접수자** | 최종 사용자로부터 VOC를 인입받는 최전선 담당자 | 콜센터 상담원, CS 담당자 등 |
| **VOC 처리 담당자** | VOC를 분석하고 처리하는 내부 담당자 | 2차 처리자, 기술 지원 등 |
| **관리자** | 시스템을 관리하는 내부 사용자 | 카테고리 관리, 계정 관리 등 |
| VOC | Voice of Customer, 고객의 소리 | 최종 사용자의 문의/불만/요청 |
| Agent | 특정 작업을 자동으로 수행하는 AI 모듈 | VOC 분석 Agent, 로그 분석 Agent |
| 유사 VOC | 벡터 유사도 기반으로 검색된 과거 VOC | pgvector 활용 |
| ELK(OpenSearch) | OpenSearch + OpenSearch Dashboard | 로그 수집/분석 시스템 |
| Ticket ID | VOC 고유 접수번호 | 형식: VOC-YYYYMMDD-XXXXX |
| Audit Log | 시스템 변경 이력 기록 | 상태 변경, 카테고리 수정 등 |

### VOC 처리 흐름도

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  최종 사용자  │────▶│  VOC 접수자  │────▶│ VOC 처리    │────▶│   관리자     │
│  (End User) │ 문의 │ (1차 담당자) │ 등록 │   담당자     │     │             │
└─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘
                           │                   │
                           ▼                   ▼
                    ┌─────────────────────────────────┐
                    │       VOC Auto Bot 시스템        │
                    │  • AI 자동 분석                  │
                    │  • 유사 VOC 검색                 │
                    │  • 로그 분석                     │
                    └─────────────────────────────────┘
```

---

## 3. 사용자 정의

| 사용자 유형 | 설명 | 주요 권한 |
|------------|------|----------|
| VOC 접수자 | 최종 사용자로부터 VOC를 인입받아 시스템에 등록하는 1차 담당자 | VOC 입력, 접수번호 조회, 상태 확인 |
| VOC 처리 담당자 | VOC를 분석하고 처리하는 내부 담당자 | VOC 처리, 분석 결과 수정, 이메일 발송 |
| 관리자 | 시스템을 관리하는 내부 사용자 | 카테고리 관리, 계정 관리, 통계 조회 |

---

## 4. 기능 요구사항

### 4.1 인증 및 권한 관리

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-001 | VOC 접수자/처리 담당자/관리자는 아이디/비밀번호로 로그인할 수 있다 | 필수 |
| FR-002 | 관리자는 사용자 계정을 생성/수정/삭제할 수 있다 | 필수 |
| FR-003 | 비밀번호는 암호화하여 저장한다 | 필수 |
| FR-004 | 로그인 실패 5회 시 계정이 잠금된다 | 선택 |
| FR-005 | 관리자는 사용자의 임시 비밀번호를 발급할 수 있다 | 필수 |
| FR-006 | 임시 비밀번호로 로그인 시 비밀번호 변경을 강제한다 | 필수 |

---

### 4.2 VOC 입력 (VOC 접수자)

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-101 | VOC 접수자는 최종 사용자의 VOC를 시스템에 입력할 수 있다 | 필수 |
| FR-102 | 최종 사용자 이메일은 필수 입력 항목이다 | 필수 |
| FR-103 | VOC 입력 완료 시 "VOC 입력이 완료되었습니다" 팝업을 노출한다 | 필수 |
| FR-104 | VOC 카테고리는 AI가 자동 분류한다 (접수자 선택 없음) | 필수 |
| FR-105 | VOC 접수 완료 시 고유 접수번호(Ticket ID)를 발급하여 노출한다 | 필수 |
| FR-106 | VOC 접수 완료 시 최종 사용자 이메일로 접수 확인 메일을 자동 발송한다 | 필수 |
| FR-107 | VOC 접수자는 입력 중 임시 저장할 수 있다 | 선택 |

#### VOC 입력 필드
| 필드명 | 필수 여부 | 설명 |
|--------|----------|------|
| 최종 사용자 이메일 | 필수 | 최종 사용자 연락처 |
| 제목 | 필수 | VOC 제목 |
| 내용 | 필수 | VOC 상세 내용 |
| 발생 시간 | 선택 | 문제 발생 시점 (로그 검색 기준) |
| 계정 ID | 선택 | 최종 사용자 서비스 계정 ID (로그 검색 기준) |
| 첨부파일 | 선택 | 스크린샷, 로그 등 |

#### 첨부파일 제약사항
| 항목 | 제한 |
|------|------|
| 최대 용량 | 파일당 10MB, 총 30MB |
| 허용 확장자 | jpg, png, gif, pdf, txt, log, zip |
| 최대 개수 | 5개 |
| 보안 검사 | 업로드 시 바이러스 스캔 수행 |

---

### 4.3 보안 및 악용 방지

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-151 | VOC 입력 API는 Rate Limiting을 적용한다 (분당 10건 제한) | 필수 |
| FR-152 | 비로그인 접근 시 CAPTCHA를 적용한다 | 선택 |
| FR-153 | 모든 텍스트 입력은 XSS 방지를 위해 sanitization을 수행한다 | 필수 |
| FR-154 | 첨부파일은 MIME 타입 검증 및 확장자 화이트리스트 검사를 수행한다 | 필수 |
| FR-155 | ZIP 파일 업로드 시 내부 파일 검사를 수행한다 | 필수 |

---

### 4.4 VOC 상태 관리

VOC는 다음 6단계 상태를 가진다:

```
접수 → 분석중 → 처리중 → 완료
         ↓         ↘ 반려
      분석실패
```

| 상태 | 설명 | 변경 주체 |
|------|------|----------|
| 접수 | VOC가 시스템에 입력된 초기 상태 | 시스템 |
| 분석중 | AI Agent가 VOC를 분석하는 중 | 시스템 |
| 분석실패 | AI/ELK(OpenSearch) 장애로 분석 실패 | 시스템 |
| 처리중 | VOC 처리 담당자가 VOC를 처리하는 중 | 담당자 |
| 완료 | VOC 처리 완료 | 담당자 |
| 반려 | VOC가 반려됨 (사유 필수) | 담당자 |

#### 상태 전이 규칙
| From | To | 조건 |
|------|-----|------|
| 접수 | 분석중 | 자동 (AI 분석 시작) |
| 분석중 | 처리중 | 분석 완료 시 자동 |
| 분석중 | 분석실패 | AI/ELK(OpenSearch) 장애 시 자동 |
| 분석실패 | 처리중 | 담당자가 수동으로 변경 |
| 처리중 | 완료 | 담당자가 처리 완료 |
| 처리중 | 반려 | 담당자가 반려 (사유 필수) |
| 완료/반려 | 처리중 | 담당자가 재처리 시작 |

---

### 4.5 VOC 분석 Agent

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-301 | VOC 접수 시 AI Agent가 비동기로 분석을 시작한다 | 필수 |
| FR-302 | 과거 유사 VOC 사례를 검색하여 제시한다 (유사도 0.7 이상, 최대 5건) | 필수 |
| FR-303 | 로그 분석 필요 여부를 판단한다 | 필수 |
| FR-304 | 로그 분석이 필요한 경우 로그 분석 Agent를 호출한다 | 필수 |
| FR-305 | DB 검색 필요 여부를 판단한다 | 필수 |
| FR-306 | DB 검색이 필요한 경우 내부 VOC DB를 조회한다 | 필수 |
| FR-307 | VOC 카테고리를 자동 분류한다 | 필수 |
| FR-308 | AI/시스템 장애 시 상태를 '분석실패'로 변경하고 담당자에게 이메일로 알림을 보낸다 | 필수 |
| FR-309 | 분석 완료 후 담당자가 카테고리를 수정하면 학습 데이터로 저장한다 | 선택 |
| FR-310 | 분석 완료 시 VOC 접수자/처리 담당자에게 이메일로 알림을 보낸다 | 필수 |

#### 분석 결과 항목
- 자동 분류된 카테고리
- 유사 VOC 목록 (VOC ID, 유사도) - 유사도 0.7 이상, 최대 5건
- 로그 분석 결과 (필요 시)
- DB 조회 결과 (필요 시)
- 추천 응대 가이드

#### 유사 VOC 검색 기준
| 항목 | 기준 |
|------|------|
| 유사도 임계값 | 0.7 이상 |
| 최대 노출 건수 | 5건 |
| 정렬 기준 | 유사도 내림차순 |

#### 비동기 처리 아키텍처
```
VOC 접수 → 즉시 Ticket ID 반환 → 분석 작업 큐에 등록
                                      ↓
                              백그라운드 분석 수행
                                      ↓
                              완료 시 상태 업데이트 + 알림
```

---

### 4.6 로그 분석 Agent

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-401 | ELK(OpenSearch)에서 관련 로그를 검색한다 | 필수 |
| FR-402 | 로그 분석 결과를 요약하여 제공한다 | 필수 |
| FR-403 | 에러 로그, 외부 연동 실패 등을 식별한다 | 필수 |
| FR-404 | ELK(OpenSearch) 연결 실패 시 분석 실패로 처리하고 담당자에게 이메일로 알림을 보낸다 | 필수 |
| FR-405 | 로그 검색 결과가 과다할 경우 최신 1,000건만 분석하고 경고 메시지를 표시한다 | 필수 |

#### 로그 검색 기준
| 검색 조건 | 설명 |
|----------|------|
| 시간 범위 | '발생 시간' 전후 10분. **발생 시간 미입력 시 VOC 접수 시간 기준** |
| 계정 식별 | 최종 사용자 이메일 또는 계정 ID로 필터링 |
| 키워드 | VOC 내용에서 추출한 에러 키워드 |
| 최대 검색 범위 | 최대 1시간 이내로 제한 (성능 보장) |

---

### 4.7 카테고리 관리

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-501 | 관리자는 VOC 카테고리를 생성/수정/삭제할 수 있다 | 필수 |
| FR-502 | 카테고리는 DB에서 관리한다 (코드 하드코딩 금지) | 필수 |
| FR-503 | 카테고리는 계층 구조를 가질 수 있다 (대분류 > 중분류) | 선택 |

#### 기본 카테고리 예시
| 대분류 | 중분류 |
|--------|--------|
| 오류/버그 | 시스템 오류, 데이터 오류, 화면 오류 |
| 문의 | 사용 방법, 기능 문의, 정책 문의 |
| 개선요청 | 기능 개선, UI/UX 개선, 신규 기능 |
| 불만 | 서비스 불만, 응대 불만 |

---

### 4.8 VOC 리스트 (담당자)

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-601 | 칸반보드 형태로 VOC 목록을 조회할 수 있다 | 필수 |
| FR-602 | 리스트 형태로 VOC 목록을 조회할 수 있다 | 필수 |
| FR-603 | 칸반보드와 리스트 뷰를 전환할 수 있다 | 필수 |
| FR-604 | VOC 클릭 시 상세 화면으로 이동한다 | 필수 |
| FR-605 | 칸반보드에서 드래그앤드롭으로 상태를 변경할 수 있다 | 선택 |
| FR-606 | 상태 전이 규칙에 위배되는 드래그앤드롭은 차단된다 | 필수 |

#### 칸반보드 컬럼
- 접수
- 분석중
- 분석실패
- 처리중
- 완료
- 반려

---

### 4.9 VOC 상세 화면 (담당자)

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-701 | VOC 기본 정보를 표시한다 (제목, 내용, 최종 사용자 이메일 등) | 필수 |
| FR-702 | AI 분석 결과를 표시한다 | 필수 |
| FR-703 | 유사 VOC가 있을 경우 VOC ID 버튼을 표시한다 | 필수 |
| FR-704 | 유사 VOC 버튼 클릭 시 팝업으로 해당 VOC를 표시한다 | 필수 |
| FR-705 | 로그 분석 결과를 표시한다 (예: 외부 연동 시스템 에러) | 필수 |
| FR-706 | DB 조회 결과를 표시한다 (예: 요청 값 오류 확인) | 필수 |
| FR-707 | 담당자는 AI가 분류한 카테고리를 수동으로 수정할 수 있다 | 필수 |
| FR-708 | 담당자 메모/코멘트를 입력할 수 있다 | 선택 |
| FR-709 | 처리 내용을 임시 저장할 수 있다 | 선택 |

---

### 4.10 VOC 상태 조회 (VOC 접수자)

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-751 | VOC 접수자는 Ticket ID로 VOC 상태를 조회할 수 있다 | 필수 |
| FR-752 | 상태 조회 시 Ticket ID + 최종 사용자 이메일 일치 여부를 검증한다 | 필수 |
| FR-753 | 조회 결과에 현재 상태, 접수일시, 예상 처리 단계를 표시한다 | 필수 |

---

### 4.11 VOC 반려

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-801 | 담당자는 VOC를 반려할 수 있다 | 필수 |
| FR-802 | 반려 시 반려 사유를 필수로 입력해야 한다 | 필수 |

---

### 4.12 최종 사용자 알림

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-901 | VOC 접수 시 최종 사용자에게 접수 확인 이메일을 자동 발송한다 | 필수 |
| FR-902 | VOC 완료/반려 시 담당자가 선택적으로 이메일을 발송할 수 있다 | 필수 |
| FR-903 | 이메일 발송 전 내용을 미리보기 할 수 있다 | 선택 |
| FR-904 | 이메일 템플릿을 관리할 수 있다 | 선택 |

---

### 4.13 이력 관리 (Audit Log)

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-1001 | VOC 상태 변경 시 변경 이력을 저장한다 (변경자, 변경시간, 이전상태, 이후상태) | 필수 |
| FR-1002 | 카테고리 수정 시 변경 이력을 저장한다 | 필수 |
| FR-1003 | VOC 상세 화면에서 변경 이력을 조회할 수 있다 | 필수 |

---

### 4.14 통계 대시보드

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| FR-1101 | 기간별 VOC 접수 건수를 조회할 수 있다 | 선택 |
| FR-1102 | 카테고리별 VOC 현황을 조회할 수 있다 | 선택 |
| FR-1103 | 평균 처리 시간을 조회할 수 있다 | 선택 |
| FR-1104 | 상태별 VOC 현황을 조회할 수 있다 | 선택 |

---

## 5. 비기능 요구사항

| ID | 요구사항 | 설명 |
|----|---------|------|
| NFR-01 | 응답시간 | VOC 접수는 즉시 완료 (Ticket ID 반환). 분석은 비동기로 수행 |
| NFR-02 | 가용성 | 시스템 가용성 99% 이상 |
| NFR-03 | 보안 | 개인정보(이메일) 암호화 저장, 입력값 sanitization |
| NFR-04 | 확장성 | 로그 분석 소스 추가 가능한 구조 |
| NFR-05 | 장애 대응 | AI/ELK(OpenSearch) 장애 시 '분석실패' 상태로 전환, 담당자 알림 |
| NFR-06 | 파일 보안 | 첨부파일 업로드 시 바이러스 스캔, 확장자/용량 제한, MIME 검증 |
| NFR-07 | 감사 추적 | 모든 상태 변경 및 주요 작업에 대한 이력 저장 |
| NFR-08 | 악용 방지 | Rate Limiting 적용, XSS 방지 |

---

## 6. 데이터 관리 정책

### 6.1 데이터 보관

| 데이터 유형 | 보관 기간 | 비고 |
|------------|----------|------|
| VOC 데이터 | 3년 | 법적 요구사항에 따라 조정 가능 |
| 로그 분석 결과 | 1년 | 원본 로그는 ELK(OpenSearch) 정책에 따름 |
| Audit Log | 5년 | 감사 목적 |
| 첨부파일 | VOC와 동일 | VOC 삭제 시 함께 삭제 |

### 6.2 개인정보 처리

| ID | 요구사항 | 우선순위 |
|----|---------|---------|
| DP-01 | 최종 사용자 이메일은 암호화하여 저장한다 | 필수 |
| DP-02 | 보관 기간 경과 시 자동 삭제 또는 익명화한다 | 필수 |
| DP-03 | 개인정보 삭제 요청 시 관련 데이터를 삭제할 수 있다 | 필수 |
| DP-04 | 개인정보 처리 내역을 로그로 기록한다 | 필수 |

---

## 7. 시스템 연동

| 연동 대상 | 용도 | 연동 방식 |
|----------|------|----------|
| ELK(OpenSearch) | 로그 분석 | REST API |
| Ollama (Local LLM) | AI 분석 | HTTP API |
| PostgreSQL + pgvector | 유사 VOC 검색 | JDBC / SQL |
| SMTP 서버 | 이메일 발송 | SMTP |
| Redis (선택) | 작업 큐, Rate Limiting | Redis Protocol |

---

## 8. 화면 목록

| 화면 ID | 화면명 | 사용자 | 설명 |
|--------|--------|--------|------|
| SC-01 | 로그인 화면 | 전체 | 시스템 로그인 |
| SC-02 | VOC 입력 화면 | VOC 접수자 | VOC 작성 및 제출 |
| SC-03 | VOC 상태 조회 화면 | VOC 접수자 | Ticket ID로 상태 조회 |
| SC-04 | VOC 리스트 (칸반) | VOC 처리 담당자 | 칸반보드 형태 목록 |
| SC-05 | VOC 리스트 (테이블) | VOC 처리 담당자 | 리스트 형태 목록 |
| SC-06 | VOC 상세 화면 | VOC 처리 담당자 | VOC 상세 및 분석 결과 |
| SC-07 | 유사 VOC 팝업 | VOC 처리 담당자 | 유사 VOC 상세 보기 |
| SC-08 | 이메일 발송 화면 | VOC 처리 담당자 | 최종 사용자 알림 이메일 작성 |
| SC-09 | 카테고리 관리 화면 | 관리자 | 카테고리 CRUD |
| SC-10 | 사용자 관리 화면 | 관리자 | 사용자 계정 관리 |
| SC-11 | 통계 대시보드 | 관리자 | VOC 통계 조회 |
