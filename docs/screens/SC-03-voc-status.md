# SC-03: VOC 상태 조회 화면

**관련 이슈**: #3
**최종 수정일**: 2026-01-23

---

## 1. 화면 개요

### 1.1 목적
VOC 접수자가 Ticket ID를 통해 VOC의 현재 처리 상태를 빠르게 조회할 수 있는 화면을 제공한다.

### 1.2 대상 사용자
- VOC 접수자 (콜센터 상담원, CS 담당자)

### 1.3 접근 경로
- URL: `/voc/status`
- 내비게이션: 메인 메뉴 > VOC 상태 조회
- 권한: VOC 접수자 역할 필수

---

## 2. 접근 권한

| 사용자 유형 | 접근 가능 여부 | 비고 |
|------------|---------------|------|
| VOC 접수자 | ✅ 가능 | 주 사용자 |
| VOC 처리 담당자 | ✅ 가능 | 상태 확인 목적 |
| 관리자 | ✅ 가능 | 전체 접근 가능 |
| 비로그인 | ❌ 불가 | 로그인 필수 |

---

## 3. 기능 요구사항

| ID | 요구사항 | 우선순위 | 관련 FR |
|----|---------|---------|---------|
| FR-751 | Ticket ID로 VOC 상태를 조회할 수 있다 | 필수 | - |
| FR-752 | Ticket ID + 최종 사용자 이메일 일치 여부를 검증한다 | 필수 | - |
| FR-753 | 조회 결과에 현재 상태, 접수일시, 예상 처리 단계를 표시한다 | 필수 | - |

---

## 4. 레이아웃 구조

### 4.1 화면 구성

```
┌─────────────────────────────────────────────────┐
│  VOC Auto Bot - 상태 조회                        │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌─ VOC 상태 조회 ────────────────────────┐     │
│  │                                        │     │
│  │  Ticket ID                             │     │
│  │  ┌─────────────────────────────────┐   │     │
│  │  │ VOC-20260123-00001              │   │     │
│  │  └─────────────────────────────────┘   │     │
│  │                                        │     │
│  │  최종 사용자 이메일                      │     │
│  │  ┌─────────────────────────────────┐   │     │
│  │  │ user@example.com                │   │     │
│  │  └─────────────────────────────────┘   │     │
│  │                                        │     │
│  │        [조회]  [초기화]                 │     │
│  │                                        │     │
│  └────────────────────────────────────────┘     │
│                                                 │
│  ┌─ 조회 결과 ──────────────────────────┐       │
│  │                                      │       │
│  │  Ticket ID: VOC-20260123-00001       │       │
│  │  상태: 처리중                         │       │
│  │  접수일시: 2026-01-23 14:30:25       │       │
│  │                                      │       │
│  │  ┌─ 처리 진행 상태 ─────────────┐    │       │
│  │  │                              │    │       │
│  │  │  ✓ 접수 (2026-01-23 14:30)  │    │       │
│  │  │  ✓ 분석중 (2026-01-23 14:31)│    │       │
│  │  │  ▶ 처리중 (2026-01-23 14:45)│    │       │
│  │  │  ○ 완료 (예상: 1-2일 소요)  │    │       │
│  │  │                              │    │       │
│  │  └──────────────────────────────┘    │       │
│  │                                      │       │
│  │  제목: 결제 오류 문의                 │       │
│  │  카테고리: 오류/버그 > 시스템 오류     │       │
│  │                                      │       │
│  └──────────────────────────────────────┘       │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 4.2 반응형 디자인
- 데스크톱: 중앙 정렬, 최대 너비 800px
- 태블릿: 패딩 조정, 전체 너비 활용
- 모바일: 1열 레이아웃, 터치 친화적 UI

---

## 5. UI 요소 목록

### 5.1 검색 폼

#### 5.1.1 Ticket ID 입력
- **컴포넌트**: Text Input
- **ID**: `ticketIdInput`
- **레이블**: "Ticket ID"
- **플레이스홀더**: "VOC-YYYYMMDD-XXXXX"
- **필수 여부**: 필수
- **최대 길이**: 22자
- **패턴**: `VOC-\d{8}-\d{5}`
- **자동 완성**: 비활성화
- **접근성**: `aria-required="true"`, `aria-describedby="ticketIdHelp"`

#### 5.1.2 최종 사용자 이메일 입력
- **컴포넌트**: Email Input
- **ID**: `userEmailInput`
- **레이블**: "최종 사용자 이메일"
- **플레이스홀더**: "user@example.com"
- **필수 여부**: 필수
- **타입**: email
- **자동 완성**: 비활성화
- **접근성**: `aria-required="true"`, `aria-describedby="emailHelp"`

#### 5.1.3 조회 버튼
- **컴포넌트**: Button (Primary)
- **텍스트**: "조회"
- **타입**: submit
- **비활성 조건**: 입력값 유효성 검증 실패 시
- **로딩 상태**: 조회 중 스피너 표시 + "조회 중..." 텍스트
- **접근성**: `aria-label="VOC 상태 조회"`

#### 5.1.4 초기화 버튼
- **컴포넌트**: Button (Secondary)
- **텍스트**: "초기화"
- **타입**: reset
- **동작**: 입력 필드 초기화 + 조회 결과 제거
- **접근성**: `aria-label="입력 초기화"`

### 5.2 조회 결과 영역

#### 5.2.1 기본 정보 카드
| 항목 | 표시 내용 | 비고 |
|------|----------|------|
| Ticket ID | VOC-20260123-00001 | 복사 가능한 텍스트 |
| 상태 | 배지 형태 (색상별) | 상태별 색상 구분 |
| 접수일시 | YYYY-MM-DD HH:mm:ss | KST 기준 |
| 제목 | VOC 제목 | 최대 2줄, 말줄임 처리 |
| 카테고리 | 대분류 > 중분류 | 계층 구조 표시 |

#### 5.2.2 처리 진행 상태 타임라인
- **컴포넌트**: Stepper / Timeline
- **표시 항목**:
  1. 접수 (완료 시간)
  2. 분석중 (완료 시간 또는 진행 중)
  3. 분석실패 (발생 시만 표시)
  4. 처리중 (완료 시간 또는 진행 중)
  5. 완료/반려 (완료 시간)

- **상태별 아이콘**:
  - 완료: ✓ (체크 아이콘, 녹색)
  - 진행중: ▶ (화살표 아이콘, 파란색)
  - 대기: ○ (원 아이콘, 회색)
  - 실패/반려: ✗ (X 아이콘, 빨간색)

- **예상 처리 시간**:
  - 분석중: "분석 중 (약 3-5분 소요)"
  - 처리중: "처리 중 (예상: 1-2일 소요)"
  - 분석실패: "담당자 확인 필요"

#### 5.2.3 상태별 배지 색상
| 상태 | 배지 색상 | 배경색 |
|------|----------|--------|
| 접수 | Blue | bg-blue-100 |
| 분석중 | Indigo | bg-indigo-100 |
| 분석실패 | Red | bg-red-100 |
| 처리중 | Yellow | bg-yellow-100 |
| 완료 | Green | bg-green-100 |
| 반려 | Gray | bg-gray-100 |

### 5.3 빈 상태 (Empty State)
- **조건**: 조회 결과가 없을 때
- **표시 내용**:
  - 아이콘: 돋보기 아이콘
  - 메시지: "조회 결과가 없습니다"
  - 설명: "Ticket ID와 이메일을 확인해주세요"

---

## 6. 사용자 액션/이벤트

### 6.1 조회 프로세스

```
사용자 입력
    ↓
유효성 검증 (클라이언트)
    ↓
[조회] 버튼 클릭
    ↓
API 요청 (Ticket ID + Email)
    ↓
┌─────────────────┐
│ 인증 및 검증     │
│ - Ticket ID 존재│
│ - Email 일치    │
└─────────────────┘
    ↓
┌─────────────────────────┐
│ 성공                    │  실패
│ - 상태 정보 표시        │  - 에러 메시지 표시
│ - 타임라인 렌더링       │  - 입력 필드 포커스
└─────────────────────────┘
```

### 6.2 이벤트 핸들러

| 이벤트 | 트리거 조건 | 동작 |
|--------|-----------|------|
| `onSubmit` | 조회 버튼 클릭 | 폼 유효성 검증 → API 호출 |
| `onReset` | 초기화 버튼 클릭 | 입력 필드 초기화 + 결과 제거 |
| `onChange` | 입력값 변경 | 실시간 유효성 검증 |
| `onCopyTicketId` | Ticket ID 클릭 | 클립보드 복사 + 토스트 알림 |

---

## 7. 유효성 검사

### 7.1 클라이언트 검증

#### Ticket ID
```typescript
const ticketIdSchema = z.string()
  .min(1, 'Ticket ID를 입력해주세요')
  .regex(
    /^VOC-\d{8}-\d{5}$/,
    'Ticket ID 형식이 올바르지 않습니다 (예: VOC-20260123-00001)'
  );
```

#### 최종 사용자 이메일
```typescript
const emailSchema = z.string()
  .min(1, '이메일을 입력해주세요')
  .email('올바른 이메일 형식이 아닙니다');
```

### 7.2 서버 검증

| 검증 항목 | 검증 내용 | 실패 시 응답 |
|----------|----------|-------------|
| Ticket ID 존재 | DB에 해당 Ticket ID 존재 여부 | 404: Ticket ID를 찾을 수 없습니다 |
| Email 일치 | 입력한 이메일과 DB 이메일 일치 | 403: 이메일이 일치하지 않습니다 |
| 권한 검증 | 로그인 사용자의 역할 확인 | 401: 권한이 없습니다 |

---

## 8. 에러 처리

### 8.1 에러 메시지

| 에러 코드 | 에러 메시지 | 사용자 안내 |
|----------|-----------|-----------|
| `TICKET_NOT_FOUND` | Ticket ID를 찾을 수 없습니다 | Ticket ID를 다시 확인해주세요 |
| `EMAIL_MISMATCH` | 이메일이 일치하지 않습니다 | 접수 시 입력한 이메일을 확인해주세요 |
| `UNAUTHORIZED` | 로그인이 필요합니다 | 로그인 페이지로 리다이렉트 |
| `NETWORK_ERROR` | 네트워크 오류가 발생했습니다 | 잠시 후 다시 시도해주세요 |
| `RATE_LIMIT_EXCEEDED` | 조회 요청이 너무 많습니다 | 1분 후 다시 시도해주세요 (Rate Limiting) |

### 8.2 에러 UI

#### 인라인 에러 (Input)
- 입력 필드 하단에 빨간색 텍스트로 표시
- 아이콘: ⚠ 경고 아이콘
- 접근성: `role="alert"`, `aria-live="polite"`

#### 토스트 알림 (API 에러)
- 화면 상단 중앙에 3초간 표시
- 색상: 에러(빨강), 경고(노랑), 성공(녹색)
- 닫기 버튼 제공
- 접근성: `role="alert"`, `aria-atomic="true"`

---

## 9. 연관 API

### 9.1 VOC 상태 조회 API

**Endpoint**: `GET /api/v1/voc/status`

**Request Query Parameters**:
```typescript
interface VocStatusQueryParams {
  ticketId: string;      // VOC-YYYYMMDD-XXXXX
  email: string;         // user@example.com
}
```

**Response (200 OK)**:
```typescript
interface VocStatusResponse {
  ticketId: string;
  status: VocStatus;
  submittedAt: string;       // ISO 8601
  title: string;
  category: {
    main: string;
    sub: string;
  };
  timeline: VocTimelineItem[];
}

interface VocTimelineItem {
  status: VocStatus;
  timestamp: string;         // ISO 8601
  isCompleted: boolean;
  estimatedDuration?: string; // "3-5분", "1-2일"
}

type VocStatus =
  | '접수'
  | '분석중'
  | '분석실패'
  | '처리중'
  | '완료'
  | '반려';
```

**Response (404 Not Found)**:
```json
{
  "error": "TICKET_NOT_FOUND",
  "message": "Ticket ID를 찾을 수 없습니다"
}
```

**Response (403 Forbidden)**:
```json
{
  "error": "EMAIL_MISMATCH",
  "message": "이메일이 일치하지 않습니다"
}
```

**Response (429 Too Many Requests)**:
```json
{
  "error": "RATE_LIMIT_EXCEEDED",
  "message": "조회 요청이 너무 많습니다",
  "retryAfter": 60
}
```

---

## 10. 화면 전환

### 10.1 진입 경로
- **메인 메뉴**: 내비게이션 > VOC 상태 조회
- **VOC 입력 완료 후**: 팝업의 "상태 조회" 버튼 클릭 시 (Ticket ID 자동 입력)

### 10.2 이탈 경로
- **내비게이션**: 다른 메뉴 선택
- **로그아웃**: 세션 종료 시 로그인 화면으로 이동

### 10.3 딥링크 지원
- **URL**: `/voc/status?ticketId=VOC-20260123-00001`
- **동작**: Ticket ID가 쿼리 파라미터로 전달되면 자동으로 입력 필드에 채움
- **보안**: 이메일은 자동 입력하지 않음 (보안상 수동 입력 필요)

---

## 11. 접근성 (Accessibility)

### 11.1 키보드 내비게이션
| 키 | 동작 |
|----|------|
| Tab | 다음 입력 필드/버튼으로 이동 |
| Shift + Tab | 이전 입력 필드/버튼으로 이동 |
| Enter | 폼 제출 (조회) |
| Escape | 에러 메시지/토스트 닫기 |

### 11.2 스크린 리더 지원
- 모든 입력 필드에 `<label>` 연결
- 에러 메시지는 `role="alert"` 속성
- 상태 배지는 `aria-label`로 상태 설명 제공
- 타임라인은 `<ol>` 또는 `role="list"` 사용

### 11.3 시각적 접근성
- 색상 대비 비율: WCAG AA 기준 준수 (4.5:1)
- 포커스 인디케이터: 명확한 아웃라인 표시
- 상태는 색상뿐만 아니라 아이콘으로도 구분

---

## 12. 성능 요구사항

| 항목 | 목표 |
|------|------|
| 조회 API 응답 시간 | 500ms 이하 |
| 페이지 로드 시간 | 1초 이하 |
| Rate Limiting | 분당 10건 (FR-151 준수) |

---

## 13. 테스트 시나리오

### 13.1 정상 시나리오
1. **정상 조회**
   - Ticket ID와 이메일 입력
   - 조회 버튼 클릭
   - 상태 정보 정상 표시

2. **딥링크 진입**
   - URL에 ticketId 파라미터 포함
   - Ticket ID 자동 입력 확인
   - 이메일 입력 후 조회

### 13.2 에러 시나리오
1. **Ticket ID 미존재**
   - 존재하지 않는 Ticket ID 입력
   - 404 에러 메시지 표시

2. **이메일 불일치**
   - 올바른 Ticket ID + 잘못된 이메일
   - 403 에러 메시지 표시

3. **Rate Limiting**
   - 1분 내 10회 초과 조회
   - 429 에러 + 재시도 시간 안내

### 13.3 접근성 테스트
1. **키보드 전용 조작**
   - Tab/Enter만으로 조회 가능 확인

2. **스크린 리더 테스트**
   - NVDA/JAWS로 모든 요소 읽기 가능 확인

---

## 14. 참고 자료

- [요구사항 정의서](/docs/REQUIREMENTS.md) - FR-751, FR-752, FR-753
- [API 명세서](/docs/api/voc-status-api.md)
- [컴포넌트 가이드](/docs/components/form-components.md)
- [디자인 시스템](/docs/design-system.md)

---

## 15. 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 2026-01-23 | 1.0.0 | 초안 작성 | Claude Opus 4.5 |
